!function(factory){"function"==typeof define&&define.amd?define(factory):factory()}((function(){"use strict";layui.use(["form","layer","jquery"],(function(form,layer,$){form.verify({route:function(value){return/^\w+$/.test(value)?value.length<2?"后台的地址不能小于2位数":void 0:"后台地址只能由英文、数字、下划线组成"},user:function(value){if(value.length<5)return["管理员账号不能小于5位数","，当前：",value.length,"位"].join("")},pass:function(value){if(value.length<6||value.length>18)return["密码必须6到18位","，当前：",value.length,"位"].join("")},confirmPass:function(value){if($("input[name=admin_password]").val()!==value)return"两次密码输入不一致！"},number:function(value){if(value&&isNaN(value))return"只能填写数字"}}),$(document).ready((function(){var loading,input=$("input[name=admin_url]"),span=$("#admin_url"),error={elem:$("#error"),show:function(msg){this.elem.hasClass("error")||this.elem.addClass("error"),this.elem.html(msg)},reset:function(){this.elem.hasClass("error")&&this.elem.removeClass("error"),this.elem.html("")}},environmental_detection=document.getElementById("environmental_detection");environmental_detection&&($(environmental_detection).on("click",(function(){return loading=layer.msg("环境效验中...",{icon:16,shade:.2,time:!1}),$.ajax({url:$(this).data("url"),type:"POST",dataType:"json",data:{type:"environmentalDetection",_token:$("meta[name=csrf-token]").attr("content")},timeout:3e3,complete:function(xhr,textStatus){loading&&layer.close(loading)},success:function(data,textStatus){200===data.code?window.location.href=data.url:layer.alert(data.message,{icon:2})},error:function(xhr,textStatus,errorThrown){layer.msg([textStatus,":",xhr.statusText,"，请稍后再试！"].join(""),{icon:2})}})})),document.onkeydown=function(e){13==(e.keyCode||e.which||e.charCode)&&$(environmental_detection).trigger("click")}),span.text(input.val()),input.bind("input propertychange",(function(){span.text($(this).val())})),form.on("submit(install)",(function(data){if($(this).hasClass("layui-btn-disabled"))return!1;error.reset(),loading=layer.msg("正在安装...",{icon:16,shade:.2,time:!1});var formdata=data.field;return formdata.type="start",$.ajax({url:formdata.action,type:"POST",dataType:"json",data:formdata,timeout:6e4,success:function(data,textStatus){200===data.code?(formdata.type="install",$.ajax({url:formdata.action,type:"POST",dataType:"json",data:formdata,timeout:6e4,complete:function(xhr,textStatus){loading&&layer.close(loading)},success:function(data,textStatus){200===data.code?layer.msg(data.message,{icon:1},(function(){window.location.href=data.url})):layer.msg(data.message,{icon:2},(function(){error.show(data.message)}))},error:function(xhr,textStatus,errorThrown){return layer.msg([textStatus,":",xhr.statusText,"，请稍后再试！"].join(""),{icon:2}),!1}})):layer.msg(data.message,{icon:2},(function(){error.show(data.message)}))},error:function(xhr,textStatus,errorThrown){return layer.msg([textStatus,":",xhr.statusText,"，请稍后再试！"].join(""),{icon:2}),!1}}),!1}))}))}))}));